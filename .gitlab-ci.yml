stages:
  - build
  - release

build:operator:
  stage: build
  image:
    name: golang:1.20.1-alpine3.16
  only:
    refs:
    - yd/v1.20.15/describe-node-listers
  variables:
    KUBE_GIT_MAJOR: "1"
    KUBE_GIT_MINOR: "20"
    KUBE_GIT_VERSION: "v1.20.15-enhanced-describe"
    KUBE_GIT_COMMIT: ${CI_COMMIT_SHA}

  artifacts:
    paths:
      - _output/bin/kubectl
  before_script:
    - apk add make bash rsync
  script:
    - make kubectl

build:release:
  stage: release
  image:
    name: node:18.14.2-alpine3.16
  only:
    refs:
    - yd/v1.20.15/describe-node-listers
  before_script:
  - apk add git
  - npm install
  script:
  - npx semantic-release